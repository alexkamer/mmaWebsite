{% extends "base.html" %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-red-900">
    <!-- Hero Section with Last Updated Badge -->
    <div class="relative overflow-hidden">
        <div class="absolute inset-0 bg-black opacity-40"></div>
        <div class="relative z-10 text-center py-20 px-4">
            <div class="max-w-4xl mx-auto">
                <div class="inline-flex items-center bg-red-600 text-white px-6 py-2 rounded-full text-sm font-semibold mb-6 animate-pulse">
                    üî• LIVE RANKINGS ‚Ä¢ Updated from UFC.com
                </div>
                <h1 class="text-5xl md:text-7xl font-black text-white mb-6 tracking-tight">
                    UFC <span class="text-red-500">RANKINGS</span>
                </h1>
                <p class="text-xl md:text-2xl text-gray-300 max-w-2xl mx-auto mb-8">
                    Official current champions and rankings across all UFC divisions
                </p>

                <!-- Division Filter Tabs -->
                <div class="flex flex-wrap justify-center gap-3 mt-8">
                    <button onclick="filterDivision('all')" class="division-filter px-6 py-3 rounded-xl font-bold transition-all duration-300 bg-white text-gray-900 hover:bg-red-500 hover:text-white active" data-division="all">
                        All Divisions
                    </button>
                    <button onclick="filterDivision('mens')" class="division-filter px-6 py-3 rounded-xl font-bold transition-all duration-300 bg-gray-800 text-white hover:bg-red-500" data-division="mens">
                        Men's ü•ä
                    </button>
                    <button onclick="filterDivision('womens')" class="division-filter px-6 py-3 rounded-xl font-bold transition-all duration-300 bg-gray-800 text-white hover:bg-red-500" data-division="womens">
                        Women's üëä
                    </button>
                    <button onclick="filterDivision('p4p')" class="division-filter px-6 py-3 rounded-xl font-bold transition-all duration-300 bg-gradient-to-r from-purple-600 to-blue-600 text-white hover:from-purple-700 hover:to-blue-700" data-division="p4p">
                        P4P üíé
                    </button>
                </div>
            </div>
        </div>
        <div class="absolute bottom-0 left-0 right-0 h-20 bg-gradient-to-t from-gray-50 to-transparent"></div>
    </div>

    <div class="bg-gray-50 py-12">
        <div class="container mx-auto px-4">

        {% if divisions %}
        <div class="space-y-12" id="divisions-container">
            {% for division_name, fighters in divisions.items() %}
            {% set is_womens = "Women's" in division_name or "women's" in division_name|lower %}
            {% set is_p4p = "Pound" in division_name %}
            <div class="division-card bg-white rounded-2xl shadow-2xl overflow-hidden border border-gray-200 hover:shadow-3xl transition-all duration-300 transform hover:-translate-y-1"
                 data-division-type="{% if is_p4p %}p4p{% elif is_womens %}womens{% else %}mens{% endif %}">

                <!-- Division Header with Champion Spotlight -->
                <div class="{% if is_p4p %}bg-gradient-to-r from-purple-900 via-purple-700 to-blue-900{% else %}bg-gradient-to-r from-gray-900 via-red-600 to-gray-900{% endif %} text-white px-8 py-6 relative overflow-hidden">
                    <div class="absolute inset-0 bg-black opacity-20"></div>
                    <div class="relative z-10">
                        <div class="flex items-center justify-between flex-wrap gap-4">
                            <div>
                                <h2 class="text-3xl md:text-4xl font-black tracking-wide flex items-center gap-3">
                                    {% if is_p4p %}
                                    üíé {{ division_name }}
                                    {% elif is_womens %}
                                    üëä {{ division_name }}
                                    {% else %}
                                    ü•ä {{ division_name }}
                                    {% endif %}
                                </h2>
                                {% set champion = fighters|selectattr('position', 'equalto', 'C')|first %}
                                {% if champion %}
                                <div class="mt-2 flex items-center gap-2">
                                    <span class="text-yellow-300 text-sm font-semibold">üëë Champion:</span>
                                    <span class="text-white text-lg font-bold">{{ champion.full_name }}</span>
                                </div>
                                {% endif %}
                            </div>
                            <div class="flex items-center gap-3">
                                <div class="text-sm font-semibold bg-white bg-opacity-20 px-4 py-2 rounded-full">
                                    {{ fighters|length }} FIGHTERS
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="absolute -right-8 -top-8 w-32 h-32 bg-white opacity-5 rounded-full"></div>
                </div>

                <!-- Fighters Grid -->
                <div class="p-6 md:p-8">
                    <!-- Champion Spotlight Card (if exists) -->
                    {% set champion = fighters|selectattr('position', 'equalto', 'C')|first %}
                    {% if champion %}
                    <div class="mb-8 bg-gradient-to-br from-yellow-50 via-amber-50 to-orange-50 border-2 border-yellow-400 rounded-2xl p-6 shadow-2xl transform hover:scale-[1.02] transition-all duration-300">
                        <div class="flex items-center gap-6 flex-wrap">
                            <!-- Champion Badge -->
                            <div class="relative">
                                <div class="w-24 h-24 bg-gradient-to-br from-yellow-400 via-yellow-500 to-yellow-600 text-white rounded-2xl flex items-center justify-center font-black shadow-2xl transform rotate-3 hover:rotate-6 transition-transform duration-300">
                                    <span class="text-4xl">üëë</span>
                                </div>
                                <div class="absolute -top-2 -right-2 w-8 h-8 bg-yellow-300 rounded-full animate-ping"></div>
                                <div class="absolute -top-2 -right-2 w-8 h-8 bg-yellow-400 rounded-full"></div>
                            </div>

                            <!-- Champion Photo -->
                            <div class="relative">
                                {% if champion.headshot_url %}
                                <img src="{{ champion.headshot_url }}" alt="{{ champion.full_name }}"
                                     class="w-32 h-32 rounded-2xl object-cover border-4 border-yellow-400 shadow-2xl">
                                {% else %}
                                <div class="w-32 h-32 rounded-2xl bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center border-4 border-yellow-400 shadow-2xl">
                                    <span class="text-5xl">ü•ä</span>
                                </div>
                                {% endif %}
                                <div class="absolute -bottom-2 -right-2 bg-yellow-500 text-white px-3 py-1 rounded-full text-xs font-black shadow-lg">
                                    CHAMP
                                </div>
                            </div>

                            <!-- Champion Info -->
                            <div class="flex-1 min-w-[200px]">
                                <div class="text-yellow-700 font-bold text-sm mb-1">REIGNING CHAMPION</div>
                                <h3 class="text-3xl md:text-4xl font-black text-gray-900 mb-2">
                                    {{ champion.full_name }}
                                </h3>
                                <div class="flex flex-wrap gap-2">
                                    <span class="px-3 py-1 bg-yellow-200 text-yellow-900 text-xs font-bold rounded-full">üëë TITLE HOLDER</span>
                                    <span class="px-3 py-1 bg-red-100 text-red-800 text-xs font-bold rounded-full">{{ division_name }}</span>
                                </div>
                            </div>

                            <!-- View Button -->
                            {% if champion.athlete_id %}
                            <a href="/fighter/{{ champion.athlete_id }}"
                               class="bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white px-8 py-4 rounded-xl font-black shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:scale-105 flex items-center gap-2 text-lg">
                                <span>View Profile</span>
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                                </svg>
                            </a>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Ranked Fighters List -->
                    <div class="space-y-3">
                        {% for fighter in fighters %}
                        {% if fighter.position != 'C' and fighter.position != 'IC' %}
                        <div class="group relative bg-white border-2 border-gray-200 hover:border-red-500 rounded-xl p-5 hover:shadow-xl transition-all duration-300 transform hover:scale-[1.01]">
                            <div class="flex items-center justify-between flex-wrap gap-4">
                                <div class="flex items-center gap-4 md:gap-6 flex-1">
                                    <!-- Rank Badge -->
                                    <div class="flex-shrink-0">
                                        <div class="w-14 h-14 bg-gradient-to-br from-gray-700 to-gray-900 text-white rounded-xl flex items-center justify-center font-black shadow-lg group-hover:shadow-2xl group-hover:from-red-600 group-hover:to-red-700 transition-all duration-300">
                                            <span class="text-lg">#{{ fighter.position }}</span>
                                        </div>
                                    </div>

                                    <!-- Fighter Photo -->
                                    <div class="flex-shrink-0 relative hidden sm:block">
                                        {% if fighter.headshot_url %}
                                        <img src="{{ fighter.headshot_url }}" alt="{{ fighter.full_name }}"
                                             class="w-16 h-16 rounded-xl object-cover border-2 border-gray-200 group-hover:border-red-500 shadow-lg transition-all duration-300">
                                        {% else %}
                                        <div class="w-16 h-16 rounded-xl bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center border-2 border-gray-200 shadow-lg">
                                            <span class="text-2xl">ü•ä</span>
                                        </div>
                                        {% endif %}
                                    </div>

                                    <!-- Fighter Info -->
                                    <div class="flex-1 min-w-0">
                                        <h3 class="text-xl font-black text-gray-900 group-hover:text-red-600 transition-colors duration-300 truncate">
                                            {{ fighter.full_name }}
                                        </h3>
                                        <div class="flex items-center gap-2 mt-1 flex-wrap">
                                            <span class="text-gray-600 font-semibold text-sm">Ranked #{{ fighter.position }}</span>
                                            <span class="px-2 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full">CONTENDER</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Action Button -->
                                <div class="flex-shrink-0">
                                    {% if fighter.athlete_id %}
                                    <a href="/fighter/{{ fighter.athlete_id }}"
                                       class="bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:scale-105 flex items-center gap-2">
                                        <span>View</span>
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                                        </svg>
                                    </a>
                                    {% else %}
                                    <div class="bg-gray-200 text-gray-500 px-6 py-3 rounded-xl font-semibold cursor-not-allowed text-sm">
                                        No Profile
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        {% else %}
        <!-- No Data State -->
        <div class="text-center py-20">
            <div class="max-w-md mx-auto bg-white rounded-2xl shadow-xl p-12">
                <div class="text-8xl mb-8 animate-bounce">üèÜ</div>
                <h2 class="text-3xl font-bold text-gray-900 mb-6">Loading Rankings...</h2>
                <p class="text-gray-600 mb-8 text-lg">UFC rankings data is being updated from official sources.</p>
                <a href="/" class="inline-flex items-center bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white px-8 py-4 rounded-xl font-bold shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Back to Home
                </a>
            </div>
        </div>
        {% endif %}

        <!-- Enhanced Footer -->
        <div class="text-center mt-16 pb-8">
            <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-lg p-8">
                <div class="flex items-center justify-center gap-3 mb-4">
                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-gray-700 font-semibold">LIVE DATA</span>
                </div>
                <p class="text-gray-600 text-lg">
                    Rankings updated daily from <span class="font-bold text-red-600">UFC.com</span>
                </p>
                <p class="text-sm text-gray-500 mt-4">
                    <strong>Current Champions:</strong> {{ divisions|length }} divisions ‚Ä¢ Official UFC Rankings
                </p>
            </div>
        </div>
        </div>
    </div>
</div>

<script>
// Division Filtering
function filterDivision(type) {
    // Update active button
    document.querySelectorAll('.division-filter').forEach(btn => {
        btn.classList.remove('active', 'bg-white', 'text-gray-900');
        btn.classList.add('bg-gray-800', 'text-white');
    });

    const activeBtn = document.querySelector(`[data-division="${type}"]`);
    if (activeBtn) {
        activeBtn.classList.add('active', 'bg-white', 'text-gray-900');
        activeBtn.classList.remove('bg-gray-800', 'text-white');
    }

    // Filter divisions
    const divisions = document.querySelectorAll('.division-card');
    divisions.forEach(div => {
        if (type === 'all') {
            div.style.display = 'block';
            setTimeout(() => div.style.opacity = '1', 10);
        } else {
            const divType = div.getAttribute('data-division-type');
            if (divType === type) {
                div.style.display = 'block';
                setTimeout(() => div.style.opacity = '1', 10);
            } else {
                div.style.opacity = '0';
                setTimeout(() => div.style.display = 'none', 300);
            }
        }
    });
}

// Smooth scroll to top button
window.addEventListener('scroll', function() {
    if (window.scrollY > 300) {
        const scrollBtn = document.getElementById('scroll-top');
        if (!scrollBtn) {
            const btn = document.createElement('button');
            btn.id = 'scroll-top';
            btn.innerHTML = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>';
            btn.className = 'fixed bottom-8 right-8 bg-red-600 text-white p-4 rounded-full shadow-2xl hover:bg-red-700 transition-all duration-300 transform hover:scale-110 z-50';
            btn.onclick = () => window.scrollTo({top: 0, behavior: 'smooth'});
            document.body.appendChild(btn);
        }
    } else {
        const scrollBtn = document.getElementById('scroll-top');
        if (scrollBtn) scrollBtn.remove();
    }
});
</script>

<style>
.division-card {
    transition: opacity 0.3s ease-in-out;
}
</style>
{% endblock %}
